# Миграция correct_answer на индекс

## Изменения:

1. ✅ Добавлено поле `correct_answer_text` в таблицу `questions` для хранения текста правильного ответа
2. ✅ Поле `correct_answer` теперь хранит индекс (0, 1, 2...) вместо текста
3. ✅ Для `multiple_choice` правильный ответ всегда имеет индекс 0 (первый в массиве [correct, wrong1, wrong2, ...])
4. ✅ Для `true_false`: Верно = 0, Неверно = 1
5. ✅ Обновлена логика в `Question` модели с методом `getCorrectAnswerText()`
6. ✅ Обновлены контроллеры и формы для работы с новой структурой

## Миграции:

1. `2026_01_12_130620_add_correct_answer_text_to_questions_table.php` - добавляет поле и конвертирует существующие данные

## Команды:

### Конвертация существующих данных:
```bash
# Проверить что будет изменено
php artisan questions:convert-to-index --dry-run

# Применить изменения
php artisan questions:convert-to-index
```

## Логика работы:

### При создании вопроса:
- Пользователь вводит текст правильного ответа в форму
- Контроллер сохраняет:
  - `correct_answer_text` = текст из формы
  - `correct_answer` = индекс (0 для multiple_choice, 0 или 1 для true_false)

### При создании викторины:
- Получаем все ответы: `[correct_answer_text, ...wrong_answers]`
- Перемешиваем массив
- Находим индекс правильного ответа в перемешанном массиве
- Сохраняем в `active_quizzes.correct_answer_index`

### При проверке ответа:
- Сравниваем индекс выбранного ответа с `active_quizzes.correct_answer_index`
- Это быстрее и точнее, чем сравнение по тексту

## Преимущества:

1. ✅ Точное сравнение по индексу - нет проблем с регистром, пробелами и т.д.
2. ✅ Быстрее обработка - сравнение чисел вместо строк
3. ✅ Меньше ошибок - не зависит от точного совпадения текста
