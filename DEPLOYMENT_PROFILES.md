# Чеклист деплоя: Система профилей и рейтинга

## 1. Применить миграции

```bash
# На сервере выполнить:
php artisan migrate
```

Это создаст таблицу `user_profiles` с полями для:
- Ника в игре
- Ссылки на Dotabuff
- Рейтинга и рангов
- Настроек отображения

## 2. Обновить существующих пользователей

После миграции нужно создать профили для существующих пользователей и пересчитать их ранги:

```bash
# Создать профили для всех пользователей, у которых есть очки
php artisan tinker
```

Затем в tinker выполнить:
```php
use App\Models\UserProfile;
use App\Models\UserScore;

// Получить всех уникальных пользователей с очками
$userIds = UserScore::distinct()->pluck('user_id');

foreach ($userIds as $userId) {
    $profile = UserProfile::getOrCreate($userId);
    $profile->updateTotalPoints();
    echo "Updated profile for user {$userId}\n";
}
```

Или создать Artisan команду для этого (см. ниже).

## 3. Проверить работу команд в боте

Протестировать в Telegram:
- `/profile` - должен показать профиль с кнопками
- `/top` - должен показать топ лидеров
- Настройка профиля через кнопки

## 4. Проверить админку

- Открыть `/admin/users` - должен показать список пользователей
- Проверить фильтры и поиск
- Открыть профиль пользователя - проверить отображение

## 5. Проверить отображение рангов

- В результатах викторин имена должны отображаться с рангами (если пользователь включил опцию)
- Проверить команду `/profile` и настройку "Показать рейтинг"

## 6. Проверить систему рангов

- Рекрут → Страж → Рыцарь → Герой → Легенда → Властилин → Божество → Титан
- У всех рангов (кроме Титана до 7000) должны быть звезды 1-5
- Титан от 7000 должен показывать позицию в топе (#1, #2 и т.д.)

## 7. Проверить Dotabuff интеграцию

- Пользователь должен иметь возможность добавить ссылку на Dotabuff
- Данные должны синхронизироваться и отображаться в профиле

## Важно:

- Если на сервере уже есть пользователи с очками, их профили нужно обновить командой выше
- Ранги рассчитываются автоматически при начислении очков
- Для существующих пользователей нужно один раз пересчитать ранги
