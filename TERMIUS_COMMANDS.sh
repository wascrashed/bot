#!/bin/bash
# –ö–æ–º–∞–Ω–¥—ã –¥–ª—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –≤ Termius –ø–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ —Ñ–∞–π–ª–æ–≤

echo "üöÄ –ù–∞—á–∞–ª–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞ –Ω–∞ —Å–µ—Ä–≤–µ—Ä–µ..."

# –ü–µ—Ä–µ—Ö–æ–¥ –≤ –ø–∞–ø–∫—É –ø—Ä–æ–µ–∫—Ç–∞
cd ~/public_html/bot || cd ~/www/bot || {
    echo "‚ùå –ü–∞–ø–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞ –Ω–µ –Ω–∞–π–¥–µ–Ω–∞!"
    echo "–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø—É—Ç—å –∫ –ø—Ä–æ–µ–∫—Ç—É"
    exit 1
}

echo "üì¶ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π..."
composer install --no-dev --optimize-autoloader

echo "üìù –°–æ–∑–¥–∞–Ω–∏–µ .env —Ñ–∞–π–ª–∞..."
if [ ! -f .env ]; then
    cp .env.example .env
    echo "‚úÖ .env —Å–æ–∑–¥–∞–Ω. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ –µ–≥–æ: nano .env"
else
    echo "‚ö†Ô∏è  .env —É–∂–µ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç"
fi

echo "üîë –ì–µ–Ω–µ—Ä–∞—Ü–∏—è –∫–ª—é—á–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è..."
php artisan key:generate

echo "üìÅ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –ø—Ä–∞–≤ –¥–æ—Å—Ç—É–ø–∞..."
chmod -R 775 storage bootstrap/cache
chown -R www-data:www-data storage bootstrap/cache 2>/dev/null || chown -R apache:apache storage bootstrap/cache 2>/dev/null

echo "üóÑÔ∏è  –í—ã–ø–æ–ª–Ω–µ–Ω–∏–µ –º–∏–≥—Ä–∞—Ü–∏–π..."
php artisan migrate --force

echo "üìä –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤–æ–ø—Ä–æ—Å–æ–≤..."
php artisan db:seed --class=Dota2QuestionsSeeder

echo "üë§ –°–æ–∑–¥–∞–Ω–∏–µ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä–∞..."
php artisan db:seed --class=AdminUserSeeder

echo "üíæ –ö–µ—à–∏—Ä–æ–≤–∞–Ω–∏–µ..."
php artisan config:cache
php artisan route:cache
php artisan view:cache

echo ""
echo "‚úÖ –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∑–∞–≤–µ—Ä—à–µ–Ω–∞!"
echo ""
echo "üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:"
echo "1. –û—Ç—Ä–µ–¥–∞–∫—Ç–∏—Ä—É–π—Ç–µ .env: nano .env"
echo "2. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ webhook: php artisan telegram:set-webhook https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/webhook/telegram"
echo "3. –ù–∞—Å—Ç—Ä–æ–π—Ç–µ Cron –≤ –ø–∞–Ω–µ–ª–∏ cp.sweb.ru"
echo "4. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª—å: https://–≤–∞—à-–¥–æ–º–µ–Ω.ru/admin"
echo ""
