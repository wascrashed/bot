# Проверка структуры БД

## Текущая структура:

### Таблица `questions`:
- ✅ `correct_answer` - индекс правильного ответа (0, 1, 2...) в исходном массиве [correct, wrong1, wrong2, ...]
- ✅ `correct_answer_text` - текст правильного ответа

### Таблица `active_quizzes`:
- ✅ `answers_order` - JSON массив перемешанных ответов [answer1, answer2, ...]
- ✅ `correct_answer_index` - индекс правильного ответа в перемешанном массиве (опционально, для справки)

### Таблица `quiz_results`:
- ✅ `answer` - **ТЕКСТ ответа**, который выбрал пользователь (не индекс!)

## Логика работы:

1. **При создании викторины:**
   - Получаем все ответы: `[correct_answer_text, ...wrong_answers]`
   - Перемешиваем: `shuffle($answers)`
   - Сохраняем в `active_quizzes.answers_order`
   - Находим индекс правильного ответа в перемешанном массиве
   - Сохраняем в `active_quizzes.correct_answer_index` (для справки)

2. **При нажатии кнопки:**
   - Получаем индекс из `callback_data`: `quiz_answer_{question_id}_{index}`
   - По индексу получаем текст из `answers_order[index]`
   - Получаем `selectedAnswer` = текст ответа

3. **При проверке:**
   - Сравниваем `selectedAnswer` (текст) с `question.correct_answer_text` (текст)
   - Нормализуем оба значения (lowercase, trim)
   - Если совпадают → правильный ответ

4. **При сохранении:**
   - Сохраняем `selectedAnswer` (текст) в `quiz_results.answer`
   - НЕ сохраняем индекс!

## Преимущества сравнения по тексту:

✅ Telegram передает значение в том же формате, что у нас в БД
✅ Не зависит от порядка ответов
✅ Работает даже если `answers_order` изменился
✅ Более надежно и понятно

## Проверка:

```bash
php artisan db:check-structure
```

Эта команда покажет:
- Структуру всех таблиц
- Примеры данных
- Логику сравнения ответов
